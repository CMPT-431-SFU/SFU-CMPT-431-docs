



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Arrvindh Shriraman">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Section 2: Compiling and Running C Programs - SFU CMPT 431 Parallel and Distributed Systems</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#section-2-compiling-and-running-c-programs" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="SFU CMPT 431 Parallel and Distributed Systems" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SFU CMPT 431 Parallel and Distributed Systems
            </span>
            <span class="md-header-nav__topic">
              
                Section 2: Compiling and Running C Programs
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/SFU-CMPT-431/SFU-CMPT-431-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    SFU-CMPT-431/SFU-CMPT-431-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../SFU-CMPT-431-T01-intro-c/" class="md-tabs__link">
          Topic Notes
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../SFU-CMPT-431-sec1-linux/" class="md-tabs__link md-tabs__link--active">
          Section Notes
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="SFU CMPT 431 Parallel and Distributed Systems" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    SFU CMPT 431 Parallel and Distributed Systems
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/SFU-CMPT-431/SFU-CMPT-431-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    SFU-CMPT-431/SFU-CMPT-431-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Topic Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Topic Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SFU-CMPT-431-T01-intro-c/" title="Topic 1: Introduction to C" class="md-nav__link">
      Topic 1: Introduction to C
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Section Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Section Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SFU-CMPT-431-sec1-linux/" title="Section 1: Linux Development Environment" class="md-nav__link">
      Section 1: Linux Development Environment
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Section 2: Compiling and Running C Programs
      </label>
    
    <a href="./" title="Section 2: Compiling and Running C Programs" class="md-nav__link md-nav__link--active">
      Section 2: Compiling and Running C Programs
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-ecelinux-machines" class="md-nav__link">
    1. The ecelinux Machines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-online-tools-to-explore-c-programs" class="md-nav__link">
    2. Using Online Tools to Explore C Programs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-replit" class="md-nav__link">
    2.1. Repl.it
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-compiler-explorer" class="md-nav__link">
    2.2. Compiler Explorer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-c-preprocessor" class="md-nav__link">
    3. C Preprocessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-compiling-and-running-a-single-file-c-program" class="md-nav__link">
    4. Compiling and Running a Single-File C Program
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-compiling-and-running-a-multi-file-c-program" class="md-nav__link">
    5. Compiling and Running a Multi-File C Program
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-experimenting-with-compiling-and-running-c-programs-for-pa1" class="md-nav__link">
    6. Experimenting with Compiling and Running C Programs for PA1
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SFU-CMPT-431-sec3-c-build-test/" title="Section 3: C Build and Test Frameworks" class="md-nav__link">
      Section 3: C Build and Test Frameworks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SFU-CMPT-431-sec4-c-test-debug/" title="Section 4: C Testing and Debugging" class="md-nav__link">
      Section 4: C Testing and Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-ecelinux-machines" class="md-nav__link">
    1. The ecelinux Machines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-online-tools-to-explore-c-programs" class="md-nav__link">
    2. Using Online Tools to Explore C Programs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-replit" class="md-nav__link">
    2.1. Repl.it
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-compiler-explorer" class="md-nav__link">
    2.2. Compiler Explorer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-c-preprocessor" class="md-nav__link">
    3. C Preprocessor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-compiling-and-running-a-single-file-c-program" class="md-nav__link">
    4. Compiling and Running a Single-File C Program
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-compiling-and-running-a-multi-file-c-program" class="md-nav__link">
    5. Compiling and Running a Multi-File C Program
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-experimenting-with-compiling-and-running-c-programs-for-pa1" class="md-nav__link">
    6. Experimenting with Compiling and Running C Programs for PA1
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SFU-CMPT-431/SFU-CMPT-431-docs/edit/master/docs/SFU-CMPT-431-sec2-c-basics.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="section-2-compiling-and-running-c-programs">Section 2: Compiling and Running C Programs<a class="headerlink" href="#section-2-compiling-and-running-c-programs" title="Permanent link">&para;</a></h1>
<p>This section serves as gentle introduction to the basics of compiling and
running C programs on the <code>ecelinux</code> machines.</p>
<h2 id="1-the-ecelinux-machines">1. The ecelinux Machines<a class="headerlink" href="#1-the-ecelinux-machines" title="Permanent link">&para;</a></h2>
<p>Follow the same process as in the last section.</p>
<ul>
<li>login to a workstation with your NetID and password</li>
<li>use MobaXterm to log into the <code>ecelinux</code> servers</li>
<li>make sure you source the setup script</li>
<li>verify ECE2400 is in your prompt</li>
</ul>
<p>Now clone the GitHub repo we will be using in this section using the
following commands:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">source</span> setup-SFU-CMPT-431.sh
% mkdir -p <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431
% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431
% git clone git@github.com:cornell-SFU-CMPT-431/ece2400-sec2 sec2
% <span class="nb">cd</span> sec2
% cat README.md
</pre></div>
</td></tr></table>

<h2 id="2-using-online-tools-to-explore-c-programs">2. Using Online Tools to Explore C Programs<a class="headerlink" href="#2-using-online-tools-to-explore-c-programs" title="Permanent link">&para;</a></h2>
<p>In this section, we will explore to online tools that can be useful when
exploring C programs. The first is Repl.it which enables us to write,
compile, and run C programs in the cloud, and the second is Compiler
Explore which enables us to compile C programs and view the corresponding
machine instructions in the cloud.</p>
<h3 id="21-replit">2.1. Repl.it<a class="headerlink" href="#21-replit" title="Permanent link">&para;</a></h3>
<p>Repl.it is a free online service which supports writing, compiling, and
executing C/C++ programs completely online in your browser. It will
enable us to quickly explore small C/C++ code snippets. Start a browser
and go to <a href="https://Repl.it">https://Repl.it</a>. You can use Repl.it without an account. You
can always create an account later. Click <em>new repl</em> in the upper
right-hand corner. In the <em>Search for a language</em> drop-down choose C and
the click <em>Create repl</em>. You will see a default program. Replace this
default program with the following program inspired by today's lecture.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;average of %d and %d is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>
  <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Click <em>run</em>. This will compile and execute your C program in the cloud
and then display the output on the right.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Change the value of <code>b</code> to 15. Recompile and execute your C program.
Is the result what you expect? Modify the <code>avg</code> function to find the
average of three values instead of just two. Modify the <code>main</code>
function to properly call your updated function and verify it
calculates the average correctly.</p>
</div>
<p>We will be using Repl.it throughout the course. We strongly encourage
students to experiment with Repl.it frequently. The best way to truly
understand computer systems programming with C and C++ is to actually
write programs, and the easiest way to write C and C++ programs is to
just use Repl.it!</p>
<h3 id="22-compiler-explorer">2.2. Compiler Explorer<a class="headerlink" href="#22-compiler-explorer" title="Permanent link">&para;</a></h3>
<p>Compiler Explore is a free online service that compiles C programs to
machine instructions and then displays these machine instructions for you
to inspect completely online in your browser. It will enable us to
quickly explore the connection between C and C++ code and the low-level
machine instructions actually executed by the computer system. Start a
browser and go to <a href="https://godbolt.org">https://godbolt.org</a>. You will see a default code
snippet. Replace this code with the following code inspired by today's
lecture.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>int avg( int x, int y )
{
  int sum = x + y;
  return sum / 2;
}
</pre></div>
</td></tr></table>

<p>Compiler Explore will automatically display the corresponding machine
instructions on the right. It color codes C code on the left to match
which exact machine instructions are produced by that C code on the
right. You can right click on an instruction and select <em>View opcode doc</em>
to learn more about what each instruction does. You can also choose from
many different compilers targeting many different instruction set
architectures (ISAs). Here are three different compiler/ISAs you might
want to experiment with:</p>
<ul>
<li>x86-64 clang 8.0.0 : This is similar to the compiler on ecelinux</li>
<li>MIPS gcc 5.4 (el) : This is similar to what is used in ECE 2400</li>
<li>RISCV-V rv32gc clang : This is similar to what is used in ECE 2400</li>
</ul>
<p>Go ahead and choose x86-64. Notice that even though the C source code
uses the integer division operator there is no division instruction on
the right. This is because the compiler is smart enough to figure out
that dividing by 2 is the same as shifting to the right by one bit. In
the upper-right corner you will either see <code>Compiler options</code> or <code>-O3</code>.
This is where you can enter command line options that are passed to the
compiler. The command line option <code>-O3</code> tells the compiler to apply as
many optimizations as it can. Experiment with either entering <code>-O3</code> or
deleting <code>-O3</code> to observe the difference in the resulting machine
instructions. Notice that without <code>-O3</code> the compiler will generate many
more instructions, and also notice that it now is using a division
instruction (<code>idiv</code>). The unoptimized code would execute far slower than
the optimized code.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Copy-and-paste the three-input average program you developed earlier
into Compiler Explore. Inspect the corresponding machine instructions
for all three compiler/ISA options mentioned above with and without
optimizations.</p>
</div>
<h2 id="3-c-preprocessor">3. C Preprocessor<a class="headerlink" href="#3-c-preprocessor" title="Permanent link">&para;</a></h2>
<p>Before we can understand how to write and compile C programs, we need to
understand the C preprocessor. The preprocessor takes an input C source
file, preprocesses it, and generates the preprocessed version of the C
source file. It is important to realize that the C preprocessor is not
really part of the C programming language. The C preprocessor simply
manipulates the plain text in the C source files and knows nothing about
the C programming language's syntax or semantics. The C preprocessor is
powerful but also very easy to abuse. Using the C preprocessor can cause
subtle bugs and is usually not necessary. Unfortunately, there are a few
cases where we have no choice but to use the C preprocessor, so we must
learn at least the basics.</p>
<p>The best way to understand the C preprocessor is actually to use it to
preprocess plain text files as opposed to C source files. Assume we wish
to create a plain text file which includes both warm and cool colors. We
could simply copy-and-paste our lists from <code>warm-colors.txt</code> and
<code>cool-colors.txt</code>, but this would be redundant and difficult to maintain
if we wanted to add a new warm or cool color. We can instead use the C
preprocessor to <em>include</em> the contents of one text file in another text
file. Use Micro (or Geany) to create a new file named <code>colors-in.txt</code>
like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% micro colors-in.txt
</pre></div>
</td></tr></table>

<p>Put the following content into this file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;warm-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cool-colors.txt&quot;</span><span class="cp"></span>
</pre></div>
</td></tr></table>

<p>Recall that you can save a file from Micro using Ctrl-S and you can quit
using Ctrl-Q.</p>
<p>The C preprocessor copies the input source file to the output source
file, while also looking for <em>C preprocessor directives</em>. All C
preprocessor directives begin with the special <code>#</code> character. The
<code>#include</code> directive specifies the file name of a different text file to
include. The file name should be be specified using double quotes (<code>""</code>).</p>
<p>Now we can use the C preprocessor (<code>cpp</code>) to preprocess the <code>-in.txt</code>
files into a final text file that contains both the warm and cool colors.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>
</pre></div>
</td></tr></table>

<p>% cd ${HOME}/SFU-CMPT-431/sec2
% cpp -o colors.txt colors-in.txt
% cat colors.txt</p>
<p>The <code>-o</code> command line option is used to specify the name of the output
file. The content of the <code>colors.txt</code> should look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># 1 &quot;colors-in.txt&quot;
# 1 &quot;&lt;built-in&gt;&quot;
# 1 &quot;&lt;command-line&gt;&quot;
# 31 &quot;&lt;command-line&gt;&quot;
# 1 &quot;/usr/include/stdc-predef.h&quot; 1 3 4
# 32 &quot;&lt;command-line&gt;&quot; 2
# 1 &quot;colors-in.txt&quot;
# 1 &quot;warm-colors.txt&quot; 1
red
orange
yellow
# 2 &quot;colors-in.txt&quot; 2
# 1 &quot;cool-colors.txt&quot; 1
blue
green
purple
# 2 &quot;colors-in.txt&quot; 2
</pre></div>
</td></tr></table>

<p>The C preprocessor has included all of the colors in a single output
file, but it has also included some additional lines beginning with the
<code>#</code> character to specify information about where all of the pieces of
text originally came from. We can tell <code>cpp</code> to not include this extra
metadata with the <code>-P</code> command line option.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% cpp -P -o colors.txt colors-in.txt
% cat colors.txt
</pre></div>
</td></tr></table>

<p>This example illustrates the first way we will use the C preprocessor. We
will use the <code>#include</code> directive to include common C source files in
several of our own C source files. This approach avoids redundancy and
makes our programs much easier to maintain since we can make changes in a
single C source file, and those changes can be immediately reflected in
any program which includes that C source file. We have actually already
seen this use of the C preprocessor earlier in this section when we
included the <code>stdio.h</code> header file which includes the declaration of the
<code>printf</code> function.</p>
<p>Let's now modify <code>colors-in.txt</code> to include each file three times:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;warm-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;warm-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;warm-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cool-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cool-colors.txt&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cool-colors.txt&quot;</span><span class="cp"></span>
</pre></div>
</td></tr></table>

<p>Rerun the C preprocessor and verify that the warm and cool colors are
included three times.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% cpp -P -o colors.txt colors-in.txt
% cat colors.txt
</pre></div>
</td></tr></table>

<p>While this is fine for plain text files, we need to be very careful about
including the same C code multiple times when we are developing our C
programs. If the compiler sees the same function defined multiple times
it will cause a syntax error. More modern programming languages have
built-in features to ensure code is only included a single time
regardless, but in C we are forced to use the C preprocessor to ensure
code is only included once. We will use a technique called <em>include
guards</em>. An include guard will ensure that the contents of a given file
is only inserted into the output file once, even if we include it
multiple times. For example, modify <code>warm-colors.txt</code> using Micro (or
Geany) as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#ifndef SEC2_WARM_COLORS_TXT</span>
<span class="cp">#define SEC2_WARM_COLORS_TXT</span>
 <span class="n">red</span>
 <span class="n">orange</span>
 <span class="n">yellow</span>
<span class="cp">#endif</span>
</pre></div>
</td></tr></table>

<p>The <code>#ifndef</code> directive is a conditional which will only include the
content after the directive if the given preprocessor macro is defined.
The <code>#define</code> directive "defines" the given preprocessor macro. So these
directives essentially check to see if <code>WARM_COLORS_TXT</code> is defined and
if not it will include the text in the file ... and <em>also</em> define
<code>WARM_COLORS_TXT</code>. If we try and include this same file again then
<code>WARM_COLORS_TXT</code> will already be defined and we will skip over the
contents of the file. Modify <code>cool-colors.txt</code> as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#ifndef SEC2_COOL_COLORS_TXT</span>
<span class="cp">#define SEC2_COOL_COLORS_TXT</span>
 <span class="n">blue</span>
 <span class="n">green</span>
 <span class="n">purple</span>
<span class="cp">#endif</span>
</pre></div>
</td></tr></table>

<p>Rerun the C preprocessor and you will see that the colors are only
included once because of the include guards.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% cpp -P -o colors.txt colors-in.txt
% cat colors.txt
</pre></div>
</td></tr></table>

<p>The actual macro name you use for the include guard doesn't matter as
long as it is unique across all files. We usually use a variation of the
filename to ensure unique include guard macros.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Change the name of the macro used in both <code>warm-colors.txt</code> and
<code>cool-colors.txt</code> to be <code>COLORS_TXT</code>. This means both files will be
using the same macro name for their include guards. Rerun the C
preprocessor. Try switching the order you include the files in
<code>colors.txt</code> (e.g., include the cool colors first, and then include
the warm colors). Can you explain what is going on?</p>
</div>
<h2 id="4-compiling-and-running-a-single-file-c-program">4. Compiling and Running a Single-File C Program<a class="headerlink" href="#4-compiling-and-running-a-single-file-c-program" title="Permanent link">&para;</a></h2>
<p>Now that we have explored how to use the C preprocessor for file
inclusion and include guards, we will can turn out attention to writing C
programs. We will begin by writing a single-file C program to calculate
the average of two integers. Our goal is to reproduce what we did with
Repl.it and Compiler Explorer, but by using various command line tools on
the <code>ecelinux</code> machines. Edit the <code>avg-sfile.c</code> code to include an
appropriate implementation of the <code>avg</code> function.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;average of %d and %d is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>
  <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>We use a <em>compiler</em> to compiler the C source code into an executable
binary (i.e., the actual bits) that the machine can understand. In this
course we will be using the GNU C compiler (<code>gcc</code>). Let's go ahead and
give this a try:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% gcc -Wall -o avg-sfile avg-sfile.c
% ls
</pre></div>
</td></tr></table>

<p>The <code>gcc</code> command takes as input the C source file to compile and the
command line option <code>-o</code> is used to specify the output exectutable binary
(i.e., the file with the machine instructions). We also use the <code>-Wall</code>
command line option to report all warnings. Note that <code>gcc</code> automatically
takes care of running the C preprocessor for us. After running the <code>gcc</code>
command you should see a new <code>avg-sfile</code> file in the directory. We can
execute this binary by simply calling it as any other Linux command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% ./avg-sfile
</pre></div>
</td></tr></table>

<p>Recall that a single dot (<code>.</code>) always refers to the current working
directory. Essentially we are telling Linux that we want to run the
executable binary named <code>avg-sfile</code> which is located in the current
working directory. Repl.it is basically doing these same steps just in
the cloud.</p>
<p>It can be tedious to to have to carefully enter the correct commands on
the command line every time we want to compile a C source file into an
executable binary. In the next section, we will explore using a <em>build
framework</em> to automate the process of building our C programs. The
process of executing the <code>avg-sfile</code> executable and verifying its output
is called <em>ad-hoc testing</em>. It is ad-hoc because there is no systematic
and automatic way to run and verify tests. In the next section, we will
explore using a <em>test framework</em> to automate the process of testing our C
programs.</p>
<p>Now let's examine the machine instructions using the <code>objdump</code> command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% objdump -dC avg-sfile <span class="p">|</span> less
</pre></div>
</td></tr></table>

<p>The <code>objdump</code> command takes an executable binary and shows you the
machine instructions in a human readable format. We are piping it through
<code>less</code> so we can scroll through the output. Try and find how many machine
instructions are used to implement the <code>avg</code> function. Compiler Explore
is basically doing these same steps just in the cloud. Recall what you
learned from experimenting with Compiler Explore earlier in this section.
Does it seem like the compiler generated optimized code or unoptimized
code? You can exit <code>less</code> by pressing the <code>q</code> key. Let's recompile our
program with optimizations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% gcc -Wall -O3 -o avg-sfile avg-sfile.c
% objdump -dC avg-sfile <span class="p">|</span> less
</pre></div>
</td></tr></table>

<p>Now how many machine instructions are used to implement the <code>avg</code>
function?</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Copy-and-paste the three-input average program you developed earlier
into <code>avg-sfile.c</code>. Recompile this program using <code>gcc</code>, and then
execute this program from the command line. Verify that it produces
the expected output. Inspect the corresponding machine instructions
with and without optimizations using <code>objdump</code>.</p>
</div>
<h2 id="5-compiling-and-running-a-multi-file-c-program">5. Compiling and Running a Multi-File C Program<a class="headerlink" href="#5-compiling-and-running-a-multi-file-c-program" title="Permanent link">&para;</a></h2>
<p>Real C programs are almost never contained in a single file. They require
many files which must be individually compiled and then <em>linked</em>
together. Linking is the process of merging together different binary
files each with its own set of machine instructions. To illustrate this
process we will break our <code>avg-sfile.c</code> source file into two files:
<code>avg.c</code> will contain the <code>avg</code> function, and <code>avg-mfile.c</code> will contain
the <code>main</code> function. We will compile each of these files into its own
object file and then link these object files into a complete executable
binary. Here is a figure illustrating the compiler and linker flow.</p>
<p><img alt="compiler flow" src="img/SFU-CMPT-431-sec2-flow.png" /></p>
<p>Go ahead and use Micro (or Geany) to create the <code>avg.c</code> file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;avg.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>And now create the <code>avg-mfile.c</code> file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;avg.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;average of %d and %d is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>
  <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>We will use <code>gcc</code> compile the <code>avg.c</code> source file into the <code>avg.o</code> object
file, and we will also use <code>gcc</code> to compile the <code>avg-mfile.c</code> source file
into the <code>avg-mfile.o</code> object file. Finally, we can use <code>gcc</code> to <em>link</em>
both object files along with the pre-compiled C standard library and any
startup code to produce an executable binary.</p>
<p>We will also need a <code>header file</code> named <code>avg.h</code>. Header files are the key
to multi-file C programs. The <code>avg-mfile.c</code> source file needs to call the
<code>avg</code> function, but the <code>avg</code> function is in a different source file.
When we compile the <code>avg-mfile.c</code> source file, how will the compiler know
that the <code>avg</code> function exists to ensure the programmer is not
accidentally calling an undefined function? How will the compiler know
what parameters the <code>avg</code> function takes, so it can perform type
checking? The <code>avg-mfile.c</code> source file cannot directly include <code>avg.c</code>
since that would result in the same function being compiled twice into
two different object files (which would cause a linker error). What we
need to do is have a way to tell <code>avg-mfile.c</code> the <code>avg</code> <em>function
prototype</em> (i.e., the interface of the function including its name,
parameter list, and return type) but not the <code>avg</code> <em>function
implementation</em>. We do this with a <code>function declaration</code>. A function
definition specifies both the function prototype (interface) and the
implementation at the same time, while a function declaration just
specifies the function prototype without the implementation. A header
file contains all of the function declarations but no function
definitions. All of the function definitions are placed in a source file
that goes along with the header file. If we want to call a function that
is defined in a different source file, then we simply use the <code>#include</code>
directive to include the appropriate header file. The linker will take
care of making sure the machine instructions corresponding to every
function definition is linked together into the executable binary. Create
a header file for <code>avg.c</code> named <code>avg.h</code> with the following contents.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#ifndef SEC2_AVG_H</span>
<span class="cp">#define SEC2_AVG_H</span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">);</span>

<span class="cp">#endif</span>
</pre></div>
</td></tr></table>

<p>Notice the include guards implemented using the C preprocessor. Let's go
ahead and compile <code>avg.c</code> and <code>avg-mfile.c</code> into their corresponding
object files:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% gcc -Wall -c -o avg.o avg.c
% gcc -Wall -c -o avg-mfile.o avg-mfile.c
</pre></div>
</td></tr></table>

<p>We use the <code>-c</code> command line option to indicate that <code>gcc</code> should create
an <em>object</em> file as opposed to a complete executable binary. An object
file is just a piece of machine instructions. We cannot actually execute
an object file; we need to link multiple object files together to create
a complete executable binary. We usually use the <code>.o</code> filename extension
to indicate that these files are object files. Let's use <code>objdump</code> to
look inside each of these object files.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% objdump -dC avg.o
% objdump -dC avg-mfile.o
</pre></div>
</td></tr></table>

<p>You should be able to see that each object file only contains a few
machine instructions. The <code>avg.o</code> object file only contains machine
instructions that correspond to the <code>avg</code> function, while the
<code>avg-mfile.o</code> object file only contains machine instructions that
correspond to the <code>main</code> function.</p>
<p>Let's link these two object files together to create a complete
executable binary that we can actually run.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% gcc -Wall -o avg-mfile avg.o avg-mfile.o
% objdump -dC avg-mfile
</pre></div>
</td></tr></table>

<p>Notice that the complete executable binary contains all of the machine
instructions for <em>both</em> the <code>avg</code> and <code>main</code> functions along with a bunch
of additional system-level code (e.g., for the <code>printf</code> function). Let's
go ahead and run the executable binary.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% ./avg-mfile
</pre></div>
</td></tr></table>

<p>We can simplify this process and do the compilation and linking in a
single step by specifying multiple C source files on a single command
line.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/sec2
% gcc -Wall -o avg-mfile avg.c avg-mfile.c
% ./avg-mfile
</pre></div>
</td></tr></table>

<p>This of course begs the question. If we can compile a project with
multiple files simply by specifying all of the files on the command line,
then why did we learn about how to: (1) compile each file individually
into an object file; and (2) link these object files together? For small
projects with just 2-3 files there is no need to use object files.
However, in a project with thousands of files, specifying all files on a
single command line will cause each recompilation to take a very long
fixed amount of time (e.g., many minutes). Even if we make a very small
change to a single source file we will have recompile <em>every</em> source
file!</p>
<p>Using object files enables modular compilation. In <em>modular compilation</em>,
we only need to recompile those source files what have changed. We can
simply reuse the previously compiled object files for those source files
that have not changed. Modulary compilation can drastically reduce
recompile times so that it is proportional to just how many changes you
have made to the source files (e.g. less than a second). One challenge
with modular compilation is it drastically increases the build
complexity. There are many more commands to enter on the command line,
and we need to carefully rack which commands need to be redone whenever
we change a C source file. In the next section, we will explore using a
<em>build framework</em> to automate the process of modular compilation for
complex C programs.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Create a new source file named <code>avg3.c</code> that contains the three-input
average program you developed earlier. Create a header file named
<code>avg3.h</code> which contains just the function prototype for the
three-input average program. Modify <code>avg-mfile.c</code> to call both the
two-input and the three-input <code>avg</code> functions. Try compiling <code>avg3.c</code>
into its own object file named <code>avg3.o</code>. Link all three files (i.e.,
<code>avg.o</code>, <code>avg3.o</code>, <code>avg-mfile.o</code>). You will see a linker error
indicating that you have two functions with the same name. The
compiler does not know how to disambiguate these two functions. Name
the three-input average function <code>avg3</code> and update the source file
(<code>avg3.c</code>), header file (<code>avg.h</code>), and <code>avg-mfile.c</code> appropriately.
Recompile the object files and try linking the program together
again. Verify that it produces the expected output.</p>
</div>
<h2 id="6-experimenting-with-compiling-and-running-c-programs-for-pa1">6. Experimenting with Compiling and Running C Programs for PA1<a class="headerlink" href="#6-experimenting-with-compiling-and-running-c-programs-for-pa1" title="Permanent link">&para;</a></h2>
<p>Let's experiment with compiling an ad-hoc test for the first programming
assignment using what we have learned in this discussion section. You can
use the following steps to clone your PA1 repo.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% mkdir -p <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431
% <span class="nb">cd</span> SFU-CMPT-431
% git clone git@github.com:cornell-SFU-CMPT-431/netid
% <span class="nb">cd</span> netid
% tree
</pre></div>
</td></tr></table>

<p>Where <code>netid</code> is your NetID. Recall that ad-hoc testing involves
compiling a program manually from command line, and using that program to
print out the result of your function. Then you can verify that the
results are as expected. We have included an ad-hoc test for each
implementation in your repo that you can use for early experimentation.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/SFU-CMPT-431/netid/pa1-math/src
% gcc -Wall -Wextra -pedantic -o pow-iter-adhoc pow-iter.c pow-iter-adhoc.c
% ./pow-iter-adhoc
% gcc -Wall -Wextra -pedantic -o sqrt-iter-adhoc sqrt-iter.c sqrt-iter-adhoc.c
% ./sqrt-iter-adhoc
</pre></div>
</td></tr></table>

<p>These ad-hoc tests will not print out the correct value because you
haven't completed the programming assignment yet, but this at least
illustrates how we can used what we have learned in this discussion
section to compile an ad-hoc test from the command line.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../SFU-CMPT-431-sec1-linux/" title="Section 1: Linux Development Environment" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Section 1: Linux Development Environment
              </span>
            </div>
          </a>
        
        
          <a href="../SFU-CMPT-431-sec3-c-build-test/" title="Section 3: C Build and Test Frameworks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Section 3: C Build and Test Frameworks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright for original site &copy; 2018 Christopher Batten
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../js/extras.js"></script>
      
    
  </body>
</html>